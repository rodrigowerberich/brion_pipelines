<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ASML Brion Software case: pipelines: Organizing pipeline messages</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">ASML Brion Software case: pipelines<span id="projectnumber">&#160;v2.0</span>
   </div>
   <div id="projectbrief">Organize pipeline logs by gathering logs from the same pipeline, decoding them and putting them in order</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('Organizing.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Organizing pipeline messages</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Organizing is divided into two parts:</p><ul>
<li>Spliting the messages by pipeline<ul>
<li><a class="el" href="split__by__pipeline_8h.html" title="This file defines the SplitByPipeline class, which is responsible for splitting log messages by their...">split_by_pipeline.h</a></li>
<li><a class="el" href="split__by__pipeline_8cc.html" title="Implementation of the SplitByPipeline class.">split_by_pipeline.cc</a></li>
</ul>
</li>
<li>Ordering and organizing the messages of the same pipeline:<ul>
<li><a class="el" href="organize__by__id_8h.html" title="This file defines the OrganizeById class, which is responsible for organizing log messages based on t...">organize_by_id.h</a></li>
<li><a class="el" href="organize__by__id_8cc.html" title="Implementation of the OrganizeById class.">organize_by_id.cc</a></li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="autotoc_md6"></a>
Spliting the messages by pipeline</h1>
<p>They are separated into different maps based on the pipeline id.</p>
<h1><a class="anchor" id="autotoc_md7"></a>
Possible types of ids and references</h1>
<p>At first glance you could imagine that the pipeline log could be represented as a chain of elements that end at one element that points at -1. But when you take into account the possible types of error that can exist it becomes a bit more complex. You could have:</p><ul>
<li>Multiple messages with the same id</li>
<li>Messages that point to themselves</li>
<li>Messages that point to an id that does not exist</li>
</ul>
<p>To better undersdand the implications of this lets take a look at the possible configuration a list can have, let's consider that elements that point to an invalid id and elements that point to nothing are the same.</p>
<p>We will use the notation x,y where x is the current id and y the next one.</p>
<p>If you have 1 element, you have two options: </p><div class="dotgraph">
<img src="dot_inline_dotgraph_2.png" alt="dot_inline_dotgraph_2.png" border="0" usemap="#dot_inline_dotgraph_2.map"/>
</div>
<p>If you have 2 elements, you have 9 options:</p>
<div class="dotgraph">
<img src="dot_inline_dotgraph_3.png" alt="dot_inline_dotgraph_3.png" border="0" usemap="#dot_inline_dotgraph_3.map"/>
</div>
<p>With 3 more if you take cases 1, 2 and 3 and have them have the same ids.</p>
<p>This already show many problematic scenarios such as detached lists and cyclic references. How should we order them?</p>
<h1><a class="anchor" id="autotoc_md8"></a>
Organizing algorithm</h1>
<p>To try and solve this a couple of choices were made.</p>
<p>1) All termination nodes, pointing to -1, will be put at the front of the list.</p>
<p>2) All nodes that point to invalid ids, will be after the termination nodes, as they are in a sense, also termination points.</p>
<p>3) The rest of the nodes will follow, maintaning when possible (cyclic dependencies) the inverse order of direction.</p>
<p>Let's look at one example to understand it better:</p>
<h2><a class="anchor" id="autotoc_md9"></a>
Example</h2>
<div class="dotgraph">
<img src="dot_inline_dotgraph_4.png" alt="dot_inline_dotgraph_4.png" border="0" usemap="#dot_inline_dotgraph_4.map"/>
</div>
<p>Consider that the notation <code>b,(c,d,d)</code> represents three messages with id <code>b</code>, one pointing to <code>c</code>, another to <code>d</code>, and a third one pointing to <code>d</code> again. The line with <code>m</code> represents a message pointing to an index <code>m</code> which does not exist.</p>
<p>Following the rules we proposed the order of output would be something similar to: </p><div class="fragment"><div class="line">(e,-1), (d,m), (d,e), (c,e), (b,c), (b,d), (b, d), (a,b)</div>
</div><!-- fragment --><p>To make that happen the following algorithm is followed:</p>
<p>1) We create 3 lists, one for general elements, one for termination elements and one for invalid id elements (ones that point to invalid ids).</p>
<p>2) Starting with any element we create a temporary chain list with the same 3 types of lists.</p>
<p>3) Add all elements with that id to the appropriate list, i.e., if it points to a valid element, to the general list, if it points to a termination, to the termination and if it points to an invalid element, to the invalid element list.</p>
<p>4) Mark this id as visited and follow the valid links that are not marked as visited.</p>
<p>5) Repeat step 3 until you have added all elements to the temporary chain list</p>
<p>6) Add the list to general chain and then repeat from step 2 until you have no elements that are not marked as visited.</p>
<p>Seeing it in action:</p>
<p>We start with with "a random" id, let's say <code>b</code>. Id <code>b</code>, has 3 elements, they all point to valid ids, so they are all added one after each other to the temporary <code>b</code> general list.</p>
<p>The elements in id <code>b</code> points to two (actually 3, but one of them is repeated) ids. <code>C</code> and <code>d</code>.</p>
<p>So let's mark <code>b</code> as visited and go to <code>c</code>.</p>
<div class="dotgraph">
<img src="dot_inline_dotgraph_5.png" alt="dot_inline_dotgraph_5.png" border="0" usemap="#dot_inline_dotgraph_5.map"/>
</div>
<p><code>C</code> only has one element, and it points to a valid element. So it goes in the temporary <code>c</code> general list. Let's mark id <code>c</code> as valid and go to id <code>e</code>.</p>
<div class="dotgraph">
<img src="dot_inline_dotgraph_6.png" alt="dot_inline_dotgraph_6.png" border="0" usemap="#dot_inline_dotgraph_6.map"/>
</div>
<p><code>e</code> also only has one element, but it points to the termination id. So it goes into the temporary <code>e</code> termination list.</p>
<div class="dotgraph">
<img src="dot_inline_dotgraph_7.png" alt="dot_inline_dotgraph_7.png" border="0" usemap="#dot_inline_dotgraph_7.map"/>
</div>
<p>Since, <code>e</code> has no next id, we now merge all temporary elements from <code>e</code> to the temporary lists from <code>c</code>. So now c has two lists: a general list and a termination list.</p>
<div class="dotgraph">
<img src="dot_inline_dotgraph_8.png" alt="dot_inline_dotgraph_8.png" border="0" usemap="#dot_inline_dotgraph_8.map"/>
</div>
<p>Now we merge the lists from <code>c</code> into the list from <code>b</code>. For general list, we add the descendent merging list into the original ending of the <code>b</code> general list. This ensures that descendent order is guaranteed.</p>
<p>For termination lists and invalid lists, the order does not matter.</p>
<div class="dotgraph">
<img src="dot_inline_dotgraph_9.png" alt="dot_inline_dotgraph_9.png" border="0" usemap="#dot_inline_dotgraph_9.map"/>
</div>
<p>Now we go to the next descendent from <code>b</code>, which is <code>d</code>. <code>d</code> has two elements. One on the general list, the other in the invalid list.</p>
<div class="dotgraph">
<img src="dot_inline_dotgraph_10.png" alt="dot_inline_dotgraph_10.png" border="0" usemap="#dot_inline_dotgraph_10.map"/>
</div>
<p>Merging the lists from <code>d</code> into <code>b</code> yields the result below. Notice how <code>(d,e)</code> went before <code>(c,e)</code>. Like said before, new chain are added at the end of the original chain. This guarantess for instance that if <code>e</code> instead of pointing to the termination, pointed to another node <code>k</code>, that node <code>k</code> would be after <code>d</code> as it should, as it is an indirect descendent.</p>
<div class="dotgraph">
<img src="dot_inline_dotgraph_11.png" alt="dot_inline_dotgraph_11.png" border="0" usemap="#dot_inline_dotgraph_11.map"/>
</div>
<p>Now we are done with <code>b</code>, so we merge <code>b</code>'s lists into the global list. And search for a new unvisited node.</p>
<div class="dotgraph">
<img src="dot_inline_dotgraph_12.png" alt="dot_inline_dotgraph_12.png" border="0" usemap="#dot_inline_dotgraph_12.map"/>
</div>
<p> <code>a</code> is the next one, it only has one element, and that goes in the temporary <code>a</code> general list. The descendent from <code>a</code> is already marked as visit, so we are done. </p><div class="dotgraph">
<img src="dot_inline_dotgraph_13.png" alt="dot_inline_dotgraph_13.png" border="0" usemap="#dot_inline_dotgraph_13.map"/>
</div>
<p><code>a</code>'s list is merged into the global list. It follows the same logic as merging to another list. The new list needs to be added at the original end of the old list. Since the original global list, that is the same as adding the new chain to the beginning.</p>
<div class="dotgraph">
<img src="dot_inline_dotgraph_14.png" alt="dot_inline_dotgraph_14.png" border="0" usemap="#dot_inline_dotgraph_14.map"/>
</div>
<p> We then append the invalid list and termination list, in this order, to the general list. And if we invert this order, we will have the desired organization of messages! </p><div class="dotgraph">
<img src="dot_inline_dotgraph_15.png" alt="dot_inline_dotgraph_15.png" border="0" usemap="#dot_inline_dotgraph_15.map"/>
</div>
<p>If you want to see more examples, please check the unit tests for the <a class="el" href="organize__by__id_8cc.html" title="Implementation of the OrganizeById class.">organize_by_id.cc</a> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
